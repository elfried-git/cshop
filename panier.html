<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mon panier - Shop Na Biso</title>
  <link rel="stylesheet" href="global.css">
  <link rel="stylesheet" href="index-modern.css">
  <link rel="stylesheet" href="panier.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Styles modernes des boutons du panier */
    .boutons-panier {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 2rem;
    }
    
    .btn {
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      font-family: var(--font-primary, 'Inter', sans-serif);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      min-height: 48px;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: 2px solid #667eea;
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a3e8f 100%);
      color: white;
      border-color: #5a6fd8;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }
    
    .btn-secondary::before {
      content: '\f053';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
    }
    
    .valider-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: 2px solid #10b981;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
    }
    
    .valider-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      border-color: #059669;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
    }
    
    .valider-btn::after {
      content: '\f054';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
    }
    
    .valider-btn:disabled {
      background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
      color: #6b7280;
      border-color: #d1d5db;
      cursor: not-allowed;
      opacity: 0.6;
      transform: none;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    /* Styles pour centrer et rendre visible le contenu du panier */
    main {
      padding: 4rem 1rem 2rem;
      min-height: calc(100vh - 120px);
      margin-top: 2rem;
    }
    
    .panier-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .panier-container h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .panier-table-container {
      overflow-x: auto;
      margin-bottom: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border: 2px solid rgba(102, 126, 234, 0.2);
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    }
    
    .panier-table {
      width: 100%;
      border-collapse: collapse;
      background: transparent;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .panier-table thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .panier-table th,
    .panier-table td {
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid rgba(102, 126, 234, 0.15);
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(5px);
    }
    
    .panier-table th {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      font-size: 0.875rem;
    }
    
    .panier-table tbody tr:hover {
      background: rgba(102, 126, 234, 0.1);
    }
    
    .panier-table tbody tr:hover td {
      background: rgba(102, 126, 234, 0.08);
      transform: translateY(-1px);
      transition: all 0.2s ease;
    }
    
    .panier-table img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 2px solid rgba(102, 126, 234, 0.2);
      background: transparent !important;
    }
    
    /* Forcer le background transparent des images même au hover */
    .panier-table tbody tr:hover img {
      background: transparent !important;
    }
    
    /* Empêcher le background de la cellule contenant l'image au hover */
    .panier-table tbody tr:hover td:first-child {
      background: transparent !important;
    }
    
    /* Style du bouton Supprimer */
    .remove-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }
    
    .remove-btn:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }
    
    .remove-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
    }
    
    .resume-panier {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .resume-panier p {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #2d3748;
    }
    
    #total-panier {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2rem;
      font-weight: 800;
    }
    
    @media (max-width: 768px) {
      main {
        padding: 3rem 0.5rem 1rem;
        margin-top: 1.5rem;
      }
      
      .panier-container {
        padding: 1rem;
        margin: 0;
        border-radius: 8px;
      }
      
      .panier-container h1 {
        font-size: 2rem;
      }
      
      .boutons-panier {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
      }
      
      .panier-table th,
      .panier-table td {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
      
      .panier-table img {
        width: 60px;
        height: 60px;
        background: transparent !important;
      }
      
      /* Forcer le background transparent des images même au hover en mobile */
      .panier-table tbody tr:hover img {
        background: transparent !important;
      }
      
      /* Empêcher le background de la cellule contenant l'image au hover en mobile */
      .panier-table tbody tr:hover td:first-child {
        background: transparent !important;
      }
    }
  </style>
</head>

<body>

  <!-- Navigation moderne -->
  <header class="modern-header">
    <nav class="nav-container">
      <div class="nav-brand">
        <a href="index.html" class="brand-link">
          <div class="brand-icon">
            <i class="fas fa-shopping-bag"></i>
          </div>
          <span class="brand-text">Shop Na Biso</span>
        </a>
      </div>

      <div class="nav-menu" id="nav-menu">
        <ul class="nav-list">
          <li><a href="index.html" class="nav-link">Accueil</a></li>
          <li><a href="quisommesnous.html" class="nav-link">À propos</a></li>
          <li><a href="index.html#produits-featured" class="nav-link">Produits</a></li>
          <li><a href="index.html#categories-section" class="nav-link">Catégories</a></li>
          <li><a href="index.html#contact" class="nav-link">Contact</a></li>
        </ul>
      </div>

      <div class="nav-actions">
        <a href="connexion.html" class="action-btn login-btn">
          <i class="fas fa-user"></i>
        </a>
        <a href="panier.html" class="action-btn cart-btn active">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" id="compteur-panier">0</span>
        </a>
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <section class="panier-container">
      <h1>Mon panier</h1>

      <div class="panier-table-container">
        <table class="panier-table">
          <thead>
            <tr>
              <th>Produit</th>
              <th>Nom</th>
              <th>Prix</th>
              <th>Quantité</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="panier-body">
          </tbody>
        </table>
      </div>

      <div class="resume-panier">
        <p><strong>Total panier :</strong> <span id="total-panier">0 €</span></p>

        <div class="boutons-panier">
          <a href="index.html#produits-featured" class="btn btn-secondary">Continuer mes achats</a>
          <button class="btn valider-btn" id="valider-btn" disabled>Valider ma commande</button>
        </div>
      </div>
    </section>
  </main>



  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("panier-body");
      const totalPanier = document.getElementById("total-panier");
      // MODIFICATION : On récupère le bouton de validation
      const boutonValider = document.getElementById("valider-btn");

      function afficherPanier() {
        const panier = JSON.parse(localStorage.getItem("panier")) || [];
        // Récupérer la devise sauvegardée depuis la page d'accueil
        const selectedCurrency = sessionStorage.getItem('selectedCountry') || 'EUR';
        tbody.innerHTML = "";
        let total = 0;

        if (panier.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 6;
          td.textContent = "Votre panier est vide.";
          td.style.textAlign = "center";
          tr.appendChild(td);
          tbody.appendChild(tr);
          // MODIFICATION : On s'assure que le bouton est bien désactivé
          boutonValider.disabled = true;
        } else {
          // MODIFICATION : Si le panier n'est pas vide, on active le bouton
          boutonValider.disabled = false;

          panier.forEach((item, index) => {
            const tr = document.createElement("tr");
            tr.setAttribute("data-index", index);

            // Conversion des prix selon la devise sauvegardée
            const prixConverti = convertirPrix(item.prix, selectedCurrency);
            const totalItem = convertirPrix(item.prix * item.quantite, selectedCurrency);
            total += item.prix * item.quantite; // Garder le total en EUR pour les calculs

            // Correction du chemin de l'image pour l'affichage dans le panier
            let imageSrc = item.image;
            
            // Vérifier si le chemin est déjà correct ou s'il faut l'ajuster
            if (imageSrc && !imageSrc.startsWith('http') && !imageSrc.startsWith('./') && !imageSrc.startsWith('../')) {
              // Si le chemin commence par "images/" mais n'est pas dans le bon contexte
              if (imageSrc.startsWith('images/') && !imageSrc.startsWith('produits_phares/')) {
                // Garder le chemin tel quel car il pointe vers le dossier images à la racine
                imageSrc = imageSrc;
              } else if (imageSrc.startsWith('produits_phares/')) {
                // Le chemin est déjà correct pour la racine
                imageSrc = imageSrc;
              } else {
                // Pour tout autre cas, assumons que c'est dans produits_phares/images/
                imageSrc = 'produits_phares/images/' + imageSrc;
              }
            }

            tr.innerHTML = `
              <td><img src="${imageSrc}" alt="${item.nom}" onerror="this.src='images/assoc.png'; this.alt='Image non disponible'"></td>
              <td>${item.nom}</td>
              <td>${prixConverti}</td>
              <td><input type="number" class="quantite-input" value="${item.quantite}" min="1" data-index="${index}"></td>
              <td>${totalItem}</td>
              <td><button class="remove-btn" data-index="${index}">Supprimer</button></td>
            `;

            tbody.appendChild(tr);
          });
        }

        // Afficher le total converti
        const totalConverti = convertirPrix(total, selectedCurrency);
        totalPanier.textContent = totalConverti;
        activerSuppression();
        activerQuantite();
      }

      function activerSuppression() {
        const boutons = document.querySelectorAll(".remove-btn");
        boutons.forEach(bouton => {
          bouton.addEventListener("click", function () {
            const index = parseInt(this.getAttribute("data-index"));
            let panier = JSON.parse(localStorage.getItem("panier")) || [];
            panier.splice(index, 1);
            localStorage.setItem("panier", JSON.stringify(panier));
            afficherPanier();
            updateCartCounter();
          });
        });
      }

      function activerQuantite() {
        const inputs = document.querySelectorAll(".quantite-input");
        inputs.forEach(input => {
          input.addEventListener("change", function () {
            const index = parseInt(this.getAttribute("data-index"));
            let panier = JSON.parse(localStorage.getItem("panier")) || [];
            panier[index].quantite = parseInt(this.value);
            localStorage.setItem("panier", JSON.stringify(panier));
            afficherPanier();
            updateCartCounter();
          });
        });
      }

      // MODIFICATION : On ajoute l'événement 'click' au bouton ici
      boutonValider.addEventListener("click", ouvrirPaiement);

      afficherPanier();
    });
  </script>

  <script>
    function ouvrirPaiement() {
      // Cette fonction ne s'exécutera que si le bouton n'est pas désactivé
      window.location.href = "paiement.html";
    }
  </script>

  <script>
    function updateCartCounter() {
      const compteur = document.getElementById("compteur-panier");
      if (compteur) {
        const panier = JSON.parse(localStorage.getItem("panier")) || [];
        const totalArticles = panier.reduce((acc, item) => acc + item.quantite, 0);
        compteur.textContent = totalArticles;
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateCartCounter();
    });
  </script>

  <!-- Script pour la conversion de devise -->
  <script>
    // Taux de conversion (Base : 1 EUR)
    const TAUX_FCFA = 655.957;
    const TAUX_USD = 1.07;

    /**
     * Convertit un prix en EUR vers la devise sélectionnée
     * @param {number} prixEur - Le prix en euros
     * @param {string} currency - La devise cible ('EUR', 'XAF' ou 'USD')
     * @returns {string} - Le prix formaté avec le symbole de la devise
     */
    function convertirPrix(prixEur, currency) {
      let newPrice;
      let currencySymbol;
      let locale = 'fr-FR';

      if (currency === 'XAF') {
        // Conversion en FCFA
        newPrice = Math.round(prixEur * TAUX_FCFA / 1000) * 1000;
        currencySymbol = ' FCFA';
        newPrice = newPrice.toLocaleString(locale);
      } else if (currency === 'USD') {
        // Conversion en USD
        newPrice = (prixEur * TAUX_USD).toFixed(2);
        currencySymbol = ' $';
        locale = 'en-US';
      } else {
        // Euro (EUR)
        newPrice = prixEur.toFixed(2);
        currencySymbol = '€';
        newPrice = newPrice.replace('.00', ''); // Enlève .00 si c'est un prix entier
      }

      return `${newPrice}${currencySymbol}`;
    }

    // Pas besoin de script supplémentaire, la devise est automatiquement récupérée depuis sessionStorage
  </script>

  <!-- Script pour le menu moderne mobile -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Navigation moderne - Menu mobile
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const navMenu = document.getElementById('nav-menu');
      
      if (mobileMenuToggle && navMenu) {
        mobileMenuToggle.addEventListener('click', () => {
          navMenu.classList.toggle('nav-open');
          mobileMenuToggle.classList.toggle('menu-open');
        });

        // Fermer le menu mobile quand on clique sur un lien
        const navLinks = navMenu.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
          link.addEventListener('click', () => {
            navMenu.classList.remove('nav-open');
            mobileMenuToggle.classList.remove('menu-open');
          });
        });

        // Fermer le menu quand on clique en dehors
        document.addEventListener('click', (e) => {
          if (!navMenu.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
            navMenu.classList.remove('nav-open');
            mobileMenuToggle.classList.remove('menu-open');
          }
        });
      }
    });
  </script>
</body>

</html>